services:
  # Single Web Service: builds frontend and serves SPA + API from Express
  - type: web
    name: chocolate-candy
    env: node
    rootDir: .
    buildCommand: |
      cd backend && npm ci && cd ..
      cd chocolate-candy && npm ci && npm run build && cd ..
    startCommand: node backend/src/server.js
    envVars:
      - key: NODE_VERSION
        value: 20
      - key: PORT
        value: 3000
      - key: JWT_SECRET
        generateValue: true
      - key: DB_DRIVER
        value: mysql
      # Set these to your managed MySQL (e.g., PlanetScale or Cloud SQL)
      - key: MYSQL_HOST
        sync: false
      - key: MYSQL_PORT
        value: 3306
      - key: MYSQL_USER
        sync: false
      - key: MYSQL_PASSWORD
        sync: false
      - key: MYSQL_DB
        sync: false
      # Use a persistent disk for uploads (served at /uploads)
      - key: UPLOAD_DIR
        value: /var/uploads
    disk:
      name: uploads
      mountPath: /var/uploads
      sizeGB: 1
